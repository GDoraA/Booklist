<!DOCTYPE html>
<html lang="hu">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>Booklist</title>

    <!-- Font Awesome ikonok -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
          integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
        <meta name="theme-color" content="#a7c7ff">
        <!-- JAV√çT√ÅS: favicon be√°ll√≠t√°sa, hogy ne 404 legyen a favicon.ico -->
    <link rel="icon" type="image/png" href="assets/books_256.png">

        <script>
        // NE regisztr√°lja a service workert, ha file:// alatt fut
        if (location.protocol !== "file:" && "serviceWorker" in navigator) {
            navigator.serviceWorker.register("./service-worker.js");

        }
        </script>


</head>

<body>
<!-- LOGIN K√âPERNY≈ê -->
<div id="loginScreen" class="page" style="max-width:400px;margin:20px auto;display:none;">
    <h1>Bejelentkez√©s</h1>
    <form id="loginForm" autocomplete="on"> 

        <label for="loginEmail">E-mail c√≠m</label>
        <input type="email" id="loginEmail" 
               name="username" 
               placeholder="pl. valaki@pelda.hu"
               autocomplete="username">

        <label for="loginPassword" style="margin-top:10px;display:block;">Jelsz√≥</label>
        <input type="password" id="loginPassword" 
               name="password" 
               placeholder="Jelsz√≥"
               autocomplete="current-password">

        <button class="btn btn-primary" style="margin-top:12px;" onclick="startLogin()">
            Bel√©p√©s
        </button>
    </form>
    <div id="loginMessage" style="margin-top:10px;color:#b02a37;display:none;"></div>
</div>

<!-- ELS≈ê JELSZ√ì BE√ÅLL√çT√ÅSA -->
<div id="passwordSetup" class="page" style="max-width:400px;margin:20px auto;display:none;">
    <h1>Els≈ë bejelentkez√©s ‚Äì jelsz√≥ be√°ll√≠t√°sa</h1>

    <p id="passwordSetupEmailInfo" style="font-size:14px;color:#555;"></p>

    <label for="newPassword">√öj jelsz√≥</label>
    <input type="password" id="newPassword" placeholder="Min. 8 karakter">

    <label for="newPassword2" style="margin-top:10px;display:block;">√öj jelsz√≥ ism√©t</label>
    <input type="password" id="newPassword2" placeholder="√çrd be √∫jra a jelsz√≥t">

    <button class="btn btn-primary" style="margin-top:12px;" onclick="saveFirstPassword()">
        Jelsz√≥ ment√©se √©s bel√©p√©s
    </button>
    <button class="btn btn-secondary" style="margin-top:8px;" onclick="cancelPasswordSetup()">
        M√©gse
    </button>

    <div id="passwordSetupMessage" style="margin-top:10px;color:#b02a37;display:none;"></div>
</div>
<div id="appContent" style="display:none;">

<!-- FEJL√âC -->
<div class="header">
    <div class="header-title">
        üìñ GDA k√∂nyvei
    </div>
</div>



<div class="container">


    <nav>
        <button id="tab_lista" class="active" onclick="mutat('lista')">
            üìù K√°rty√°k
        </button>
        <button id="tab_tabla" onclick="mutat('tabla')">
            üìä T√°bl√°zat
        </button>

        <button id="tab_import" onclick="mutat('import')">
            üì• Import
        </button>
        <button id="tab_logout" onclick="logout()" style="margin-left:auto;color:#eb8f98;">
            üö™ Kil√©p√©s
        </button>
        </nav>


    <!-- LISTA -->
    <div class="page" id="lista">
        <h1>K√∂nyvlista</h1>

        <div class="stats-bar">
            <div class="stat-card stat-all">
                √ñsszes k√∂nyv: <span id="stat_total">0</span>
            </div>

            <div class="stat-card stat-owned">
                Megv√°s√°rolva: <span id="stat_purchased">0</span>
            </div>

            <div class="stat-card stat-missing">
                Nincs m√©g meg: <span id="stat_missing">0</span>
            </div>
        </div>


        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:10px;">
            <button class="btn btn-primary" onclick="openBookModal('new')">‚ûï √öj k√∂nyv felv√©tele</button>
            <button class="btn btn-secondary" onclick="betoltesLista()">üîÑ Lista friss√≠t√©se</button>
        </div>

        <h3>üîç Sz≈±r√©s</h3>
<div class="filters">

    <div>
        <input id="ls_szerzo" 
               list="authors_list_filter" 
               placeholder="Szerz≈ë"
               oninput="listaSzures()">
        <datalist id="authors_list_filter"></datalist>
    </div>

    <div>
        <input id="ls_cim" 
               placeholder="C√≠m"
               oninput="listaSzures()">
    </div>

    <div>
        <input id="ls_sorozat" 
               list="series_list_filter" 
               placeholder="Sorozat"
               oninput="listaSzures()">
        <datalist id="series_list_filter"></datalist>
    </div>

    <div>
        <input id="ls_ev_min" 
               type="number" 
               min="1" max="9999" step="1"
               placeholder="√âv (t√≥l)"
               oninput="validateYearFilter(this); listaSzures()">
    </div>

    <div>
        <input id="ls_ev_max" 
               type="number" 
               min="1" max="9999" step="1"
               placeholder="√âv (ig)"
               oninput="validateYearFilter(this); listaSzures()">
    </div>

    <div>
        <select id="ls_megv" onchange="listaSzures()">
            <option value="x" selected>Megv√°s√°rolva</option>
            <option value="no">Nincs m√©g meg</option>
            <option value="all">√ñsszes k√∂nyv</option>
        </select>
    </div>

</div>

        <button class="btn btn-secondary" onclick="clearListaFilters()" style="margin-top:10px;">
            Sz≈±r≈ëk t√∂rl√©se
        </button>

        <!-- üîΩ ELEM-SZ√ÅM + LAPOZ√ÅS BLOKK üîΩ -->
        <div class="pagination-bar">
            <div>
                <label>Elemek sz√°ma:</label>
                <select id="limitSelect" onchange="changeLimit()">
                    <option value="all" selected>√ñsszes</option>
                    <option value="10">10</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                    <option value="500">500</option>
                    <option value="1000">1000</option>
                </select>

            </div>
            <div id="itemCount" class="item-count">Tal√°latok: ‚Ä¶</div>
            <div class="pager">
                <button onclick="firstPage()">‚èÆÔ∏è</button>
                <button onclick="prevPage()">‚óÄÔ∏è</button>
                <span id="pageInfo">1 / 1</span>
                <button onclick="nextPage()">‚ñ∂Ô∏è</button>
                <button onclick="lastPage()">‚è≠Ô∏è</button>
            </div>
        </div>
        <!-- üîº ELEM-SZ√ÅM + LAPOZ√ÅS BLOKK üîº -->
        <!-- √öJ: k√°rtya n√©zet kont√©nere -->
        <div id="cardContainer" class="card-container"></div>

    </div>

    <!-- T√ÅBL√ÅZATOS LISTA -->
    <div class="page" id="tabla">
        <h1>T√°bl√°zatos lista</h1>
        <h3>üîç Sz≈±r√©s</h3>
        <div class="filters">

            <div>
                <input id="ts_szerzo"
                    list="authors_list_filter_tabla"
                    placeholder="Szerz≈ë"
                    oninput="tablaSzures()">
                <datalist id="authors_list_filter_tabla"></datalist>
            </div>

            <div>
                <input id="ts_cim"
                    placeholder="C√≠m"
                    oninput="tablaSzures()">
            </div>

            <div>
                <input id="ts_sorozat"
                    list="series_list_filter_tabla"
                    placeholder="Sorozat"
                    oninput="tablaSzures()">
                <datalist id="series_list_filter_tabla"></datalist>
            </div>

            <div>
                <input id="ts_ev_min"
                    type="number" min="1" max="9999" step="1"
                    placeholder="√âv (t√≥l)"
                    oninput="validateYearFilter(this); tablaSzures()">
            </div>

            <div>
                <input id="ts_ev_max"
                    type="number" min="1" max="9999" step="1"
                    placeholder="√âv (ig)"
                    oninput="validateYearFilter(this); tablaSzures()">
            </div>

            <div>
                <select id="ts_megv" onchange="tablaSzures()">
                    <option value="x" selected>Megv√°s√°rolva</option>
                    <option value="no">Nincs m√©g meg</option>
                    <option value="all">√ñsszes k√∂nyv</option>
                </select>

            </div>

        </div>

    <button class="btn btn-secondary" onclick="clearTablaFilters()" style="margin-top:10px;">
        Sz≈±r≈ëk t√∂rl√©se
    </button>
        <div class="table-wrapper mt-8">
            <div class="table-scroll">
                <table id="tabla_lista">
                    <thead>
                        <tr>
                            <!-- √öJ SORSZ√ÅM OSZLOP -->
                            <!-- index.html ‚Äì Sorsz√°m oszlop st√≠lusos fejl√©ce -->
                            <th style="width:50px; text-align:right;">Ssz.</th>
                            <th class="sortable" onclick="setSort('Author')">Szerz≈ë</th>
                            <th class="sortable" onclick="setSort('Title')">C√≠m</th>
                            <th class="sortable" onclick="setSort('Series')">Sorozat</th>
                            <th class="sortable" onclick="setSort('Year')">√âv</th>
                            <th class="sortable" onclick="setSort('Purchased')">Megv.</th>
                            <th class="sortable" onclick="setSort('For_sale')">Elad√≥</th>
                            <th class="sortable" onclick="setSort('Price')">√År</th>
                            <th>M≈±velet</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        
    </div>

    <!-- IMPORT -->
    <div class="page" id="import">
        <h1>CSV / TSV import√°l√°sa</h1>

        <p>Elv√°rt strukt√∫ra (List f√ºl fejl√©c sorrendje):</p>
        <pre>ID,Author,Title,Original_Title,Previous_Title,Series,Number,URL,Year,Purchased,For_sale</pre>

        <p>A f√°jl lehet vessz≈ëvel, pontosvessz≈ëvel vagy TAB-bal tagolt.</p>

        <input type="file" id="csvFile" accept=".csv,.tsv,.txt"><br><br>
        <button class="btn btn-primary" onclick="importCsv()">Import√°l√°s</button>

        <h3>Eredm√©ny:</h3>
        <div id="importResult"></div>
    </div>

    <h3 style="margin-top:22px;">Log</h3>
    <div id="log"></div>

</div> <!-- /container -->



</div> <!-- /appContent -->
<!-- MODAL: √öj k√∂nyv / Szerkeszt√©s ‚Äì k√∂z√∂s ≈±rlap -->
<div id="bookModal" class="modal-overlay">
    <div class="modal">
        <div class="modal-header">
            <h2 id="modalTitle">K√∂nyv</h2>
            <button class="modal-close-btn" onclick="closeBookModal()">&times;</button>
        </div>

        <input type="hidden" id="bm_id">

        <div class="modal-grid">

            <input id="bm_szerzo" list="authors_list_modal" placeholder="Szerz≈ë *">
            <datalist id="authors_list_modal"></datalist>

            <input id="bm_cim" placeholder="C√≠m *">

            <input id="bm_eredeti" placeholder="Eredeti c√≠m">

            <input id="bm_korabbi" placeholder="Kor√°bbi c√≠m">

            <input id="bm_sorozat" list="series_list_modal" placeholder="Sorozat">
            <datalist id="series_list_modal"></datalist>

            <input id="bm_ssz" placeholder="Sorsz√°m">

            <input id="bm_ev" type="number" min="1" max="9999" step="1"
                placeholder="√âv" oninput="validateYearFilter(this)">

            <input id="bm_url" placeholder="K√©p URL (ha nincs felt√∂lt√∂tt k√©p)" oninput="urlPreviewUpdate()">


            <div class="modal-checkbox-row">
                <input type="checkbox" step="1" id="bm_purchased">
                <label for="bm_purchased">Megv√°s√°rolva</label>
            </div>

            <div class="modal-checkbox-row">
                <input type="checkbox" step="1" id="bm_forsale">
                <label for="bm_forsale">Elad√≥</label>
            </div>

            <input id="bm_ar" type="number" step="1" placeholder="√År">
            
            <textarea id="bm_megjegy" rows="3" placeholder="Megjegyz√©s"></textarea>



        </div>

        <div class="modal-image-section">
            <span class="img-label">Bor√≠t√≥ el≈ën√©zet</span><br>
            <img id="bm_preview" alt="Bor√≠t√≥ el≈ën√©zet" style="max-width:200px; display:none;">
        </div>



        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeBookModal()">M√©gse</button>
            <button class="btn btn-primary" onclick="saveBookFromModal()">Ment√©s</button>
        </div>
    </div>
</div>
<script src="app.js"></script>
</body>
</html>
